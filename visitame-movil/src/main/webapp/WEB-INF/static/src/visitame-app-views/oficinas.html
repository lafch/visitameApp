<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/paper-spinner/paper-spinner.html">
<link rel="import" href="../visitame-app-styles/main-style.html">
<link rel="import" href="../visitame-app-styles/oficinas-style.html">
<link rel="import" href="../visitame-app-services/geolocalizacion-service.html">


<dom-module id="oficinas-view">
  <template>
    <style include="main-styles">
      :host {

      }
      
      paper-spinner{
      
      position: fixed;
  z-index: 999;
  height: 2em;
  width: 2em;
  overflow: show;
  margin: auto;
  top: 0;
  left: 0;
  bottom: 0;
  right: 0;
  font-size: 3.2em;
      
      }
      
    </style>

    <style include="oficinas-styles">

    </style>

	<geolocalizacion-service id = "geoLocalizacionService"  ></geolocalizacion-service>
	
    <div class="main-list-oficina">
     	  <paper-spinner id="loadingLista" active></paper-spinner>
	      <ul>
	        <template is="dom-repeat" items="{{listOficinas}}">
	        
	          <li>
	            <img src="{{pathParent}}images/icon_{{item.iconColor}}.png" />
	            <h3>{{item.name}}</h3>
	            <p>{{item.description}}</p>
	          </li>
	        </template>
	
	
	      </ul>
    </div>
  </template>

  <script>
    class OficinasView extends Polymer.Element {
      static get is() { return 'oficinas-view'; }

      static get properties(){
        return {
              pathParent : {
                  type : String,
                  value :'static/'
              },
              listOficinas : {
                type : Array,
                value : []
              }
        }
      }

      handleResponse(response) {
        let data = [];
        if(response.data.hasMoreData){
          let i = 1;
          let iconColor;
          response.data.pois.forEach((poi,index)=>{
              if(i > 3){ i = 1; }

              if(i == 1){
                iconColor = 'amarillo';
              }else if(i == 2){
                iconColor = 'rojo';
              }else if(i == 3){
                iconColor = 'verde';
              }

              data.push(
                {
                  name : 'OFICINA ' + poi.description + ' ' + poi.address2,
                  description : poi.address,
                  iconColor : iconColor
                }
              );
              i++;
          });
          this.$.loadingLista.active = false;
          this.listOficinas = data;
        }

      }

      ready() {
             super.ready();
			navigator.geolocation.getCurrentPosition((position) =>{
				 var geolocalizacionService = this.$.geoLocalizacionService;
			     var requestOficinas = geolocalizacionService.listarOficinas({
						params : {"latitud":"-12.092055", "longitud":"-77.022102", "radius": "15000", "type": "O"}
			     });
			     requestOficinas.then((xhr) => {
					this.handleResponse(xhr.response);
			    });
			});
             
      }


    }

    window.customElements.define(OficinasView.is, OficinasView);
  </script>
</dom-module>
